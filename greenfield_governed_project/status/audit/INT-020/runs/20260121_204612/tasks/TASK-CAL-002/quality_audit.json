{
  "type": "task_quality_audit_report",
  "schema_version": 1,
  "intent_id": "INT-020",
  "run_id": "20260121_204612",
  "task_id": "TASK-CAL-002",
  "timestamp": "2026-01-21T20:49:54Z",
  "functional": {
    "status": "pass",
    "notes": "Auto-fit produces explicit success/fail with required diagnostics; markings coverage score is deterministic.",
    "evidence": [
      "pipeline/src/fusbal_pipeline/calibration/auto_fit.py: validate_markings_observations_v1(), marking_coverage_score_v1(), cmd_auto_fit()",
      "pipeline/src/fusbal_pipeline/calibration/diagnostics.py: CalibrationDiagnosticsV1",
      "pipeline/fixtures/calibration/venues/example_venue/pitch_a/markings_observations.json",
      "Command: `PYTHONPATH=pipeline/src python -m fusbal_pipeline.calibration.auto_fit --inputs pipeline/fixtures/calibration/venues/example_venue/pitch_a/calibration_input.json --markings pipeline/fixtures/calibration/venues/example_venue/pitch_a/markings_observations.json` (exit 0, ok=true, includes rms/inlier_ratio/num_inliers/coverage)",
      "spec/md/docs/data/OUTPUT_CONTRACT.mdt: documents markings_observations and diagnostics fields"
    ],
    "findings": [
      "Auto-fit returns a `CalibrationResultV1` with `calibration_kind`, `homography_pitch_to_image_3x3`, and `diagnostics` including required metrics.",
      "`image_pre_undistorted=false` is handled trust-first: explicit failure reason `image_not_pre_undistorted_v1`.",
      "Coverage scoring implements the V1 required-label ratio exactly."
    ]
  },
  "nonfunctional": {
    "correctness_safety": {
      "status": "pass",
      "notes": "Trust-first behavior: explicit failure on missing labels, undistortion assumption violations, singular fits, and unmet thresholds.",
      "evidence": [
        "pipeline/src/fusbal_pipeline/calibration/auto_fit.py:262",
        "pipeline/src/fusbal_pipeline/calibration/auto_fit.py:379"
      ],
      "findings": [
        "Failure paths return diagnostics with `status=fail` and `failure_reason` instead of producing best-guess homographies.",
        "Quality thresholds are enforced before reporting success."
      ]
    },
    "performance": {
      "status": "pass",
      "notes": "Computation is bounded and deterministic; flips search is 2^5=32 fits.",
      "evidence": [
        "pipeline/src/fusbal_pipeline/calibration/auto_fit.py:331"
      ],
      "findings": [
        "No unbounded scans; per-run CPU cost is small and predictable for V1 required labels."
      ]
    },
    "security": {
      "status": "pass",
      "notes": "Inputs are JSON-parsed; no command execution; paths are not interpolated into shell commands.",
      "evidence": [
        "pipeline/src/fusbal_pipeline/calibration/auto_fit.py:139"
      ],
      "findings": [
        "All operations are in-process and deterministic; no obvious injection surfaces."
      ]
    },
    "maintainability": {
      "status": "pass",
      "notes": "Implementation is readable and provenance-tagged; primary maintainability risk is numeric robustness and drift across duplicated schema validators.",
      "evidence": [
        "pipeline/src/fusbal_pipeline/calibration/auto_fit.py:161",
        "pipeline/src/fusbal_pipeline/contract.py:375"
      ],
      "findings": [
        "Homography solve uses normal equations + Gaussian elimination; adequate for fixtures but can be numerically fragile in real data.",
        "Schema validation logic exists both here and in `pipeline/src/fusbal_pipeline/contract.py`."
      ]
    },
    "overall_status": "pass"
  },
  "gate": {
    "status": "pass",
    "blockers": []
  },
  "audit_inputs": {
    "task_spec_path": "spec/tasks/TASK-CAL-002.json",
    "deliverable_paths": [
      "pipeline/src/fusbal_pipeline/calibration/auto_fit.py",
      "pipeline/src/fusbal_pipeline/calibration/diagnostics.py",
      "pipeline/fixtures/calibration/venues/example_venue/pitch_a/markings_observations.json",
      "pipeline/src/fusbal_pipeline/contract.py",
      "spec/md/docs/data/OUTPUT_CONTRACT.mdt"
    ],
    "code_paths_reviewed": [
      "pipeline/src/fusbal_pipeline/calibration/auto_fit.py",
      "pipeline/src/fusbal_pipeline/calibration/diagnostics.py",
      "pipeline/src/fusbal_pipeline/calibration/inputs.py",
      "pipeline/src/fusbal_pipeline/calibration/pitch_templates.py",
      "pipeline/src/fusbal_pipeline/contract.py",
      "pipeline/fixtures/calibration/venues/example_venue/pitch_a/markings_observations.json",
      "spec/md/docs/data/OUTPUT_CONTRACT.mdt"
    ]
  },
  "summary": {
    "overall_health_0_to_10": 7,
    "notes": "Meets V1 functional requirements with deterministic scoring and explicit failure semantics; main risk is numerical robustness and representativeness of fixtures."
  }
}
