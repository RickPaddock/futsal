{
  "schema_version": 1,
  "type": "requirements_area",
  "area": "greenfield",
  "requirements": [
    {
      "id": "GREENFIELD-GOV-001",
      "status": "canonical",
      "tracking": { "implementation": "todo" },
      "guardrails": ["guardrails:markdown_generated_only", "generate:check"],
      "title": "All human-readable .md outputs are generated; no hand-edits allowed.",
      "acceptance": [
        "All `.md` files contain generated frontmatter and fail guardrails if missing.",
        "Humans edit only canonical JSON sources and templates, then regenerate."
      ],
      "owner": "platform",
      "tags": ["governance", "generation"]
    },
    {
      "id": "GREENFIELD-GOV-002",
      "status": "canonical",
      "tracking": { "implementation": "todo" },
      "guardrails": ["guardrails:deterministic_generation", "generate:check"],
      "title": "Generation is deterministic and drift is detectable.",
      "acceptance": [
        "`npm run generate:check` fails if generated outputs drift from canonical sources.",
        "`npm run guardrails` runs generate check before declaring success."
      ],
      "owner": "platform",
      "tags": ["governance", "generation"]
    },
    {
      "id": "GREENFIELD-GOV-003",
      "status": "canonical",
      "tracking": { "implementation": "todo" },
      "guardrails": ["guardrails:intent_status_model"],
      "title": "Intent status model is enforced (draft → todo → closed).",
      "acceptance": [
        "`draft` intents have no tasks/work packages.",
        "`todo` intents have tasks wired.",
        "`closed` intents require `closed_date`."
      ],
      "owner": "platform",
      "tags": ["governance", "intents"]
    },
    {
      "id": "GREENFIELD-GOV-004",
      "status": "canonical",
      "tracking": { "implementation": "todo" },
      "guardrails": ["guardrails:tasks_required_for_todo_intents"],
      "title": "Every non-draft intent must have task specs for all planned tasks.",
      "acceptance": [
        "For each `intent.task_ids_planned[]`, a matching `spec/tasks/<TASK_ID>.json` exists.",
        "Task specs must reference the same `intent_id`."
      ],
      "owner": "platform",
      "tags": ["governance", "tasks"]
    },
    {
      "id": "GREENFIELD-GOV-005",
      "status": "canonical",
      "tracking": { "implementation": "todo" },
      "guardrails": ["guardrails:task_deliverables_required"],
      "title": "Every `todo` task has at least one deliverable.",
      "acceptance": [
        "If a task is `status: todo`, `deliverables[]` is present and non-empty.",
        "Each deliverable has a stable id and human title."
      ],
      "owner": "platform",
      "tags": ["governance", "tasks"]
    },
    {
      "id": "GREENFIELD-GOV-006",
      "status": "canonical",
      "tracking": { "implementation": "todo" },
      "guardrails": ["guardrails:req_new_requirements_flow"],
      "title": "New requirements are created and tracked via `REQ-*` subtasks.",
      "acceptance": [
        "Any subtask id starting with `REQ-` must exist as a requirement entry.",
        "New requirements start with `tracking.implementation: todo`.",
        "New `REQ-*` requirements include `guardrails:req_tag_enforced_on_done` to prevent regressions."
      ],
      "owner": "platform",
      "tags": ["governance", "requirements"]
    },
    {
      "id": "GREENFIELD-GOV-007",
      "status": "canonical",
      "tracking": { "implementation": "todo" },
      "guardrails": ["guardrails:close_updates_req_tracking", "intent:close"],
      "title": "Closing an intent updates requirement implementation tracking only after code exists.",
      "acceptance": [
        "`npm run intent:close -- --apply` sets intent status to `closed` and writes `closed_date`.",
        "For any `REQ-*` created by the intent, `tracking.implementation` is set to `done` only when code contains `REQ: REQ-*` references."
      ],
      "owner": "platform",
      "tags": ["governance", "close"]
    },
    {
      "id": "GREENFIELD-GOV-008",
      "status": "canonical",
      "tracking": { "implementation": "todo" },
      "guardrails": ["guardrails:file_size_limits"],
      "title": "Governance file size limits are enforced to prevent runaway specs.",
      "acceptance": [
        "File size limits are configured in `spec/project.json` and enforced by guardrails."
      ],
      "owner": "platform",
      "tags": ["governance", "scale"]
    },
    {
      "id": "GREENFIELD-GOV-009",
      "status": "canonical",
      "tracking": { "implementation": "todo" },
      "guardrails": ["guardrails:requirements_split_supported"],
      "title": "Requirements are split into multiple area files via an index entrypoint.",
      "acceptance": [
        "`spec/requirements/index.json` lists `spec/requirements/areas/*.json` files.",
        "Generation and guardrails read from the index and treat the bundle as canonical."
      ],
      "owner": "platform",
      "tags": ["governance", "requirements"]
    },
    {
      "id": "GREENFIELD-GOV-010",
      "status": "canonical",
      "tracking": { "implementation": "todo" },
      "guardrails": ["guardrails:requirement_guardrail_coverage_required"],
      "title": "Every requirement declares at least one guardrail/coverage mechanism to detect regressions.",
      "acceptance": [
        "All requirement entries include a non-empty `guardrails[]` list.",
        "Guardrails enforce the presence of the `guardrails[]` list."
      ],
      "owner": "platform",
      "tags": ["governance", "requirements"]
    },
    {
      "id": "GREENFIELD-GOV-012",
      "status": "canonical",
      "tracking": { "implementation": "todo" },
      "guardrails": ["guardrails:repository_guardrails"],
      "title": "Task specs are gold-standard and machine-checkable (scope, acceptance, file-level deliverables, and provable subtasks).",
      "acceptance": [
        "All `todo` tasks include non-empty `scope[]` and `acceptance[]`.",
        "All deliverables have file-level `paths[]` (no directory-only paths) and non-empty deliverable `acceptance[]`.",
        "All `todo` tasks include non-empty `subtasks[]` and every subtask includes `provenance_prefix` + non-empty `done_when[]`."
      ],
      "owner": "platform",
      "tags": ["governance", "tasks", "quality"]
    },
    {
      "id": "GREENFIELD-GOV-013",
      "status": "canonical",
      "tracking": { "implementation": "todo" },
      "guardrails": ["guardrails:repository_guardrails", "guardrails:req_tag_enforced_on_done"],
      "title": "Every `REQ-*` requirement includes a regression guardrail (cannot be marked implemented without code references).",
      "acceptance": [
        "Any requirement whose id starts with `REQ-` includes `guardrails:req_tag_enforced_on_done`.",
        "`npm run guardrails` fails if any `REQ-*` requirement omits the guardrail.",
        "`tracking.implementation: done` is rejected unless the repo contains a `REQ: <REQ_ID>` reference."
      ],
      "owner": "platform",
      "tags": ["governance", "requirements", "regression"]
    },
    {
      "id": "GREENFIELD-GOV-014",
      "status": "canonical",
      "tracking": { "implementation": "todo" },
      "guardrails": ["intent:close", "manual:repo_review"],
      "title": "Intents are closed only via the close process (no manual status flips).",
      "acceptance": [
        "Users do not manually set intent `status: closed` in JSON; they run `npm run intent:close -- --apply`.",
        "Close requires required audits and guardrails to have passed and to be evidenced under `status/audit/<INTENT_ID>/runs/<run_id>/`.",
        "Intent `closed_date` is set only by the close process."
      ],
      "owner": "platform",
      "tags": ["governance", "intents", "close"]
    },
    {
      "id": "GREENFIELD-OPS-001",
      "status": "canonical",
      "tracking": { "implementation": "todo" },
      "guardrails": ["manual:ops_runbook", "manual:portal_review"],
      "title": "Logging and error surfacing are usable for audits and operators.",
      "acceptance": [
        "Scripts print stable, searchable prefixes (e.g. `[generate]`, `[guardrails]`, `[audit]`, `[close]`).",
        "Portal actions that run automation (Refresh) surface errors and show actionable stdout/stderr."
      ],
      "owner": "platform",
      "tags": ["ops", "logging", "observability"]
    },
    {
      "id": "GREENFIELD-OPS-002",
      "status": "canonical",
      "tracking": { "implementation": "todo" },
      "guardrails": ["manual:ops_runbook"],
      "title": "Starting the internal portal clears common dev ports and starts reliably.",
      "acceptance": [
        "Starting the portal clears ports 3015–3020 (kills LISTEN pids) before launching Next dev server.",
        "Startup runs generation before starting the portal so data is current."
      ],
      "owner": "platform",
      "tags": ["ops", "portal", "devex"]
    },
    {
      "id": "GREENFIELD-PORTAL-001",
      "status": "canonical",
      "tracking": { "implementation": "todo" },
      "guardrails": ["portal:ui_smoke", "manual:portal_review"],
      "title": "Internal portal task pages are human-readable (not raw JSON).",
      "acceptance": [
        "`/internal/tasks/<TASK_ID>` renders task scope, acceptance, deliverables, and subtasks as structured sections.",
        "Raw canonical JSON remains accessible (e.g., via a collapsible section) for debugging and audits.",
        "Task pages link back to the parent intent when `intent_id` is present."
      ],
      "owner": "platform",
      "tags": ["portal", "ux", "governance"]
    },
    {
      "id": "GREENFIELD-PORTAL-002",
      "status": "canonical",
      "tracking": { "implementation": "todo" },
      "guardrails": ["portal:ui_smoke", "manual:portal_review"],
      "title": "Internal portal provides copy-ready prompts for create/implement/audit/close flows.",
      "acceptance": [
        "`/internal/intents` includes a 'Create prompt' action that shows the gold-standard intent creation prompt in an overlay.",
        "For intents with `status: todo`, actions 'Implement', 'Audit', and 'Close' appear and open overlays containing the gold-standard prompts.",
        "Prompts are prefilled with the intent id and include run_id/closed_date defaults suitable for pasting into an LLM.",
        "Prompts are sourced from canonical templates under `spec/prompts/*.prompt.txt` (not hardcoded ad-hoc text).",
        "No VS Code tasks/wizard flow is required to use the system; the portal is sufficient to obtain all prompts."
      ],
      "owner": "platform",
      "tags": ["portal", "ux", "workflows"]
    },
    {
      "id": "GREENFIELD-PORTAL-003",
      "status": "canonical",
      "tracking": { "implementation": "todo" },
      "guardrails": ["portal:ui_smoke", "manual:portal_review"],
      "title": "Portal surfaces intents in priority order with clickable work items.",
      "acceptance": [
        "`/internal/intents` lists intents ordered by status (todo first, then draft, then closed).",
        "Each intent links to its detail page; each planned task is clickable and human-readable.",
        "Intent list shows audit pass/fail state from evidence runs when available."
      ],
      "owner": "platform",
      "tags": ["portal", "ux", "workflow"]
    },
    {
      "id": "GREENFIELD-PORTAL-004",
      "status": "canonical",
      "tracking": { "implementation": "done" },
      "guardrails": ["portal:ui_smoke", "manual:portal_review"],
      "title": "Portal refresh regenerates governed surfaces and reports failures.",
      "acceptance": [
        "Pressing Refresh triggers `npm run generate` and updates portal-visible surfaces.",
        "If generation fails, the portal shows actionable error output."
      ],
      "owner": "platform",
      "tags": ["portal", "generation", "ops"]
    },
    {
      "id": "GREENFIELD-PORTAL-005",
      "status": "canonical",
      "tracking": { "implementation": "done" },
      "guardrails": ["portal:ui_smoke", "manual:portal_review"],
      "title": "Portal lifecycle actions are derived from evidence-based readiness rules.",
      "acceptance": [
        "Portal offers Implement when an intent has tasks and not all tasks are resolved.",
        "Portal offers Audit when all planned tasks are resolved.",
        "Portal offers Close only when all planned tasks are resolved, required per-task quality audits exist and pass, and close-gate evidence exists and passes.",
        "Intent list and intent detail pages use the same readiness computation and do not use manual toggles."
      ],
      "owner": "platform",
      "tags": ["portal", "workflows", "governance"]
    },
    {
      "id": "GREENFIELD-PORTAL-006",
      "status": "canonical",
      "tracking": { "implementation": "done" },
      "guardrails": ["portal:ui_smoke", "manual:portal_review"],
      "title": "Portal validates and surfaces close-gate evidence status.",
      "acceptance": [
        "Portal checks each intent close gate command from generated scope and indicates satisfied/missing.",
        "A close gate is satisfied only when a `run.json` evidence record exists with `exit_code: 0` and a matching command.",
        "Portal surfaces the exact missing gate command(s) when Close is blocked."
      ],
      "owner": "platform",
      "tags": ["portal", "evidence", "close"]
    },
    {
      "id": "GREENFIELD-PORTAL-007",
      "status": "canonical",
      "tracking": { "implementation": "done" },
      "guardrails": ["portal:ui_smoke", "manual:portal_review"],
      "title": "Portal surfaces per-task quality audit status and blocks close when audits are missing/failing.",
      "acceptance": [
        "Portal displays per-task quality audit status for all tasks in `spec/intents/<INTENT_ID>.json:task_ids_planned[]`.",
        "Portal refuses to present Close as available when any planned task is missing the required per-task quality audit JSON or when any is failing.",
        "Portal distinguishes missing audits from missing close-gates when close is blocked."
      ],
      "owner": "platform",
      "tags": ["portal", "audit", "quality", "close"]
    },
    {
      "id": "GREENFIELD-PORTAL-008",
      "status": "canonical",
      "tracking": { "implementation": "done" },
      "guardrails": ["portal:ui_smoke", "manual:portal_review"],
      "title": "Portal identifies missing planned tasks in the generated tracker feed.",
      "acceptance": [
        "If an intent declares a planned task that is missing from the generated feed, portal surfaces it as missing.",
        "When planned tasks are missing from the feed, Close is considered impossible and the portal explains why."
      ],
      "owner": "platform",
      "tags": ["portal", "tasks", "governance"]
    },
    {
      "id": "GREENFIELD-PORTAL-009",
      "status": "canonical",
      "tracking": { "implementation": "done" },
      "guardrails": ["portal:ui_smoke", "manual:portal_review"],
      "title": "Portal close failures explain missing audits vs missing gates (no generic errors).",
      "acceptance": [
        "When Close is blocked, portal lists missing per-task audit files separately from missing close-gate commands.",
        "Portal does not fail with a generic 'unknown' when structured missing information exists."
      ],
      "owner": "platform",
      "tags": ["portal", "ux", "close"]
    },
    {
      "id": "GREENFIELD-PORTAL-010",
      "status": "canonical",
      "tracking": { "implementation": "done" },
      "guardrails": ["portal:ui_smoke", "manual:portal_review"],
      "title": "Portal root route (/) is a dashboard entrypoint.",
      "acceptance": [
        "The portal renders a home page at `/` linking to governed workflow pages (e.g., `/internal/intents`).",
        "Deep internal routes are not the only entrypoint."
      ],
      "owner": "platform",
      "tags": ["portal", "ux"]
    },
    {
      "id": "GREENFIELD-PORTAL-011",
      "status": "canonical",
      "tracking": { "implementation": "done" },
      "guardrails": ["portal:ui_smoke", "manual:portal_review"],
      "title": "Portal serves prompt templates via a stable API and validates substitutions.",
      "acceptance": [
        "Portal exposes an API endpoint to fetch rendered prompts for create/implement/audit/close.",
        "The API fills stable variables including intent id, run id, and closed date (where applicable).",
        "If prompt loading or rendering fails, portal overlays show explicit errors.",
        "If any placeholders remain (e.g., `<...>`), the API returns an explicit error rather than silently returning an invalid prompt."
      ],
      "owner": "platform",
      "tags": ["portal", "workflows", "prompts"]
    },
    {
      "id": "GREENFIELD-PORTAL-012",
      "status": "canonical",
      "tracking": { "implementation": "done" },
      "guardrails": ["manual:portal_review", "manual:security_review"],
      "title": "Portal refresh is same-origin hardened and writes evidence of generation runs.",
      "acceptance": [
        "Refresh rejects cross-origin requests and only accepts same-origin calls by default.",
        "Refresh writes a `run.json` evidence record for the generation run (intent-scoped when applicable).",
        "Refresh returns actionable stdout/stderr to the caller on failure."
      ],
      "owner": "platform",
      "tags": ["portal", "generation", "security", "evidence"]
    },
    {
      "id": "GREENFIELD-PORTAL-013",
      "status": "canonical",
      "tracking": { "implementation": "done" },
      "guardrails": ["manual:repo_review"],
      "title": "Portal uses a shared read-model module for filesystem-backed domain logic.",
      "acceptance": [
        "Intent/task pages and API routes share a single implementation for reading feed/spec/audit artefacts.",
        "Readiness and evidence validation logic lives in shared utilities (not duplicated across pages)."
      ],
      "owner": "platform",
      "tags": ["portal", "maintainability"]
    },
    {
      "id": "GREENFIELD-PORTAL-014",
      "status": "canonical",
      "tracking": { "implementation": "done" },
      "guardrails": ["manual:repo_review", "portal:ui_smoke"],
      "title": "Portal audit run discovery supports nested run stages consistently.",
      "acceptance": [
        "Portal discovers evidence runs under `status/audit/<INTENT_ID>/runs/<RUN_ID>/**/run.json` (nested stages).",
        "List and detail pages compute audit pass/fail from the same run discovery logic."
      ],
      "owner": "platform",
      "tags": ["portal", "evidence", "observability"]
    },
    {
      "id": "GREENFIELD-PORTAL-015",
      "status": "canonical",
      "tracking": { "implementation": "done" },
      "guardrails": ["manual:security_review"],
      "title": "Portal validates route and API parameters used for filesystem access.",
      "acceptance": [
        "Portal validates intent ids and task ids against expected formats before using them in file paths.",
        "Invalid ids return 400/404 with explicit errors and do not read arbitrary filesystem paths."
      ],
      "owner": "platform",
      "tags": ["portal", "security", "safety"]
    },
    {
      "id": "GREENFIELD-PORTAL-016",
      "status": "canonical",
      "tracking": { "implementation": "done" },
      "guardrails": ["manual:portal_review"],
      "title": "Portal renders large artefacts as summaries with raw links (avoids giant JSON dumps by default).",
      "acceptance": [
        "Intent pages show a concise summary for audit reports and quality reports, with links to view/download raw JSON.",
        "Portal remains usable when artefacts grow beyond small sizes."
      ],
      "owner": "platform",
      "tags": ["portal", "ux", "scale"]
    },
    {
      "id": "GREENFIELD-PORTAL-017",
      "status": "canonical",
      "tracking": { "implementation": "done" },
      "guardrails": ["manual:repo_review"],
      "title": "Portal server-side rendering avoids unnecessary synchronous IO and scales with intent count.",
      "acceptance": [
        "Portal limits run discovery and file reads to bounded work per request.",
        "Portal code uses shared helpers to avoid repeated reading of the same artefacts."
      ],
      "owner": "platform",
      "tags": ["portal", "performance"]
    },
    {
      "id": "GREENFIELD-PORTAL-018",
      "status": "canonical",
      "tracking": { "implementation": "done" },
      "guardrails": ["manual:portal_review"],
      "title": "Prompt overlays allow choosing the run_id and reuse it across actions.",
      "acceptance": [
        "Prompt overlays default to a generated UTC run id but allow the user to edit it.",
        "Rendered prompts use the chosen run id when filling templates."
      ],
      "owner": "platform",
      "tags": ["portal", "ux", "workflows"]
    },
    {
      "id": "GREENFIELD-PORTAL-019",
      "status": "canonical",
      "tracking": { "implementation": "done" },
      "guardrails": ["manual:portal_review"],
      "title": "Portal renders audit timestamps in UK-local format for intent/task views.",
      "acceptance": [
        "Intent detail page renders per-task audit timestamps in UK format (Europe/London) and links to the run report.",
        "Audit run timestamps in portal tables are consistently shown in UK format."
      ],
      "owner": "platform",
      "tags": ["portal", "ux", "audits"]
    },
    {
      "id": "GREENFIELD-PORTAL-020",
      "status": "canonical",
      "tracking": { "implementation": "done" },
      "guardrails": ["portal:ui_smoke", "manual:portal_review"],
      "title": "Portal provides an interactive preflight review prompt for intents before implementation.",
      "acceptance": [
        "Intent list and intent detail pages expose a 'Preflight' action for non-closed intents.",
        "Preflight opens a copy-ready prompt overlay that instructs the LLM to review the intent and ask clarifying questions before implementation.",
        "Preflight prompt is sourced from `spec/prompts/*.prompt.txt` via the prompt API (not hardcoded).",
        "Prompt API rejects prompts with leftover placeholders (e.g., `<...>`)."
      ],
      "owner": "platform",
      "tags": ["portal", "ux", "workflows", "prompts"]
    },
    {
      "id": "GREENFIELD-GOV-011",
      "status": "canonical",
      "tracking": { "implementation": "todo" },
      "guardrails": ["manual:prompt_review", "manual:portal_review"],
      "title": "All governed workflows are prompt-driven with explicit evidence capture (no undocumented manual steps).",
      "acceptance": [
        "Create/Implement/Audit/Close each have a gold-standard prompt template (or portal-generated prompt) that fully specifies the steps and commands.",
        "Create prompts MUST add any new `REQ-*` requirements to `spec/requirements/**.json` immediately with `tracking.implementation: \"todo\"` and `guardrails:req_tag_enforced_on_done`.",
        "Audit prompts MUST run `npm run audit:intent` AND `npm run guardrails`, and write evidence JSON under `status/audit/<INTENT_ID>/runs/<run_id>/` (use a unique run_id per run).",
        "Audit prompts MUST enumerate all 10 improvement recommendations (titles + ROI/effort/risk) in the chat output; do not truncate to a top-N subset.",
        "Close prompts MUST only close after audits pass and guardrails pass, and requirement tracking moves to `done` only when the repo contains `REQ: <REQ_ID>` references."
      ],
      "owner": "platform",
      "tags": ["governance", "workflows", "evidence"]
    },
    {
      "id": "GREENFIELD-GOV-015",
      "status": "canonical",
      "tracking": { "implementation": "done" },
      "guardrails": ["intent:close", "manual:prompt_review"],
      "title": "Closing an intent requires per-task quality audit evidence for all planned tasks.",
      "acceptance": [
        "For every task in `spec/intents/<INTENT_ID>.json` → `task_ids_planned[]`, a task quality audit report exists at `status/audit/<INTENT_ID>/runs/<run_id>/tasks/<TASK_ID>/quality_audit.json`.",
        "Each task quality audit report includes a gate status and blockers list and must pass (`gate.status: \"pass\"`, `gate.blockers: []`) before close can apply.",
        "Close dry-run (no apply) fails with actionable errors when any required task quality audit is missing or failing."
      ],
      "owner": "platform",
      "tags": ["governance", "close", "quality", "evidence"]
    },
    {
      "id": "GREENFIELD-GOV-016",
      "status": "canonical",
      "tracking": { "implementation": "done" },
      "guardrails": ["audit:intent", "manual:prompt_review"],
      "title": "Each intent declares functional + non-functional quality areas and assigns planned tasks to both.",
      "acceptance": [
        "Each `spec/intents/<INTENT_ID>.json` declares `quality_areas[]` including exactly one `area_id: \"functional\"` and one `area_id: \"nonfunctional\"`.",
        "Both areas include non-empty `task_ids[]` that are disjoint and whose union equals `task_ids_planned[]`.",
        "The non-functional area declares `categories_required` including: `correctness_safety`, `performance`, `security`, `maintainability`."
      ],
      "owner": "platform",
      "tags": ["governance", "intents", "quality"]
    },
    {
      "id": "GREENFIELD-GOV-017",
      "status": "canonical",
      "tracking": { "implementation": "done" },
      "guardrails": ["intent:close", "manual:prompt_review"],
      "title": "Per-task quality audit evidence covers functional + non-functional validation and is required to close.",
      "acceptance": [
        "Audit runs produce per-task reports at `status/audit/<INTENT_ID>/runs/<run_id>/tasks/<TASK_ID>/quality_audit.json` that include both `functional` and `nonfunctional` sections.",
        "Per-task non-functional validation covers: correctness/safety, performance, security, maintainability.",
        "Close fails if any planned task is missing the per-task quality audit report, or if any report does not pass functional + non-functional gates."
      ],
      "owner": "platform",
      "tags": ["governance", "audit", "close", "quality", "evidence"]
    }
  ]
}
